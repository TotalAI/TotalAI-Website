<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="icon" href="images/TotalAILogoTrans32.png" type="image/x-icon">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600|Roboto Mono&amp;display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Goldman&display=swap" rel="stylesheet">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link rel="stylesheet" href="main.css">

    <title>Total AI</title>
  </head>
  <body>
    
    <nav class="navbar sticky-top tai-navbar">
      <a class="navbar-brand" style="margin-top: -8px; margin-bottom: -8px;" href="index.html">
        <img src="images/TotalAILogoTrans.png" height="40" alt="" loading="lazy">
      </a>
    
      <ul class="nav mr-auto">
        <li class="nav-item">
          <a class="nav-link" href="index.html">Home <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" href="doc-introduction.html">Guide</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="insp-introduction.html">Inspectors</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="script-introduction.html">Scripts</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="videos.html">Videos</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="about.html">About</a>
        </li>
      </ul>
      <ul class="nav justify-content-end">
        <li class="nav-item" style="padding-right: 50px;">
          <a class="nav-link" target="_blank" href="https://github.com/TotalAI/TotalAI">
            Download on GitHub
            <svg width="1em" height="1em" viewBox="0 0 20 20" class="bi bi-box-arrow-up-right" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" d="M8.636 3.5a.5.5 0 0 0-.5-.5H1.5A1.5 1.5 0 0 0 0 4.5v10A1.5 1.5 0 0 0 1.5 16h10a1.5 1.5 0 0 0 1.5-1.5V7.864a.5.5 0 0 0-1 0V14.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5z"/>
              <path fill-rule="evenodd" d="M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793L6.146 9.146a.5.5 0 1 0 .708.708L15 1.707V5.5a.5.5 0 0 0 1 0v-5z"/>
            </svg>
          </a>
        </li>
      </ul>
    </nav>
     
    <main style="width: 100%">
    <div class="container-fluid">
      <div class="row flex-xl-nowrap">
        <div class="col-md-3 col-xl-2" style="position: sticky; top: 0; z-index: 1000; height: calc(100vh - 4rem); order: 0; overflow-y: auto; padding-top: 10px; padding-bottom: 40px;">
          <h3 class="nav-header">Getting Started</h3>
          <ul class="nav flex-column">
            <li class="nav-item">
              <a class="nav-link" href="doc-introduction.html">Introduction</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="doc-installation.html">Install & Setup</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="doc-demo.html">Demo Worlds</a>
            </li>
          </ul>
          <h3 class="nav-header">Entities</h3>
          <ul class="nav flex-column navbar-light">
            <li class="nav-item">
              <a class="nav-link" href="doc-agent.html">Agent</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="doc-worldobject.html">WorldObject</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="doc-agentevent.html">AgentEvent</a>
            </li>
          </ul>
          <h3 class="nav-header">Levels</h3>
          <ul class="nav flex-column navbar-light">
            <li class="nav-item">
              <a class="nav-link" href="doc-drive.html">Drive</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="doc-action.html">Action</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="doc-attribute.html">Attribute</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="doc-tag.html">Tag</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="doc-role.html">Role</a>
            </li>
          <h3 class="nav-header">Agent</h3>
          <ul class="nav flex-column navbar-light">
            <li class="nav-item">
              <a class="nav-link" href="doc-agent-main-loop.html">Main Loop</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="doc-movementtype.html">Movement Type</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="doc-animationtype.html">Animation Type</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="doc-sensortype.html">Sensor Type</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="doc-memorytype.html">Memory Type</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="doc-decider.html">Decider</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="doc-plannertype.html">Planner Type</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="doc-mapping.html">Plans & Mappings</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="doc-behavior.html">Behavior</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="doc-historytype.html">History Type</a>
            </li>
          </ul>
          <h3 class="nav-header">AI Types</h3>
          <ul class="nav flex-column navbar-light">
            <li class="nav-item">
              <a class="nav-link" href="doc-fsm.html">FSM</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="doc-goap.html">GOAP</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="doc-utility-ai.html">Utility AI</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="doc-deep-rl.html">Deep RL</a>
            </li>
          </ul>
          <h3 class="nav-header">Other</h3>
          <ul class="nav flex-column navbar-light">
            <li class="nav-item">
              <a class="nav-link" href="doc-inventory.html">Inventory</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="doc-design-principles.html">Design Principles</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="doc-scriptableobjects.html">ScriptableObjects</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="doc-utility-curve.html">Utility Curve</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="doc-utility-function.html">Utility Function</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="doc-included-ui.html">UI & Placement</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="doc-more-resources.html">External Links</a>
            </li>
          </ul>
        </div>
      <div class="col-md-1">

      </div>
      <div class="col content" style="padding-top: 40px; padding-bottom: 40px; line-height: 1.6em; color: #304455; font-size: 1rem;">
        <h1>Plans & Mappings</h1>
        
        <h3>What are Plans?</h3>
        <hr>
        <p>
          Plans are for a single DriveType and have a list of Root Mappings.  A Root Mapping is the start of the Plan Tree
          and contains the Mapping Type that has an OutputChange that reduces the DriveType Level.  Plans are generated by
          the <a class="text-link" href="doc-plannertype.html">PlannerType</a>.
          <br><br>
          Plans also contain information on the status of each Plan.
        </p>

        <h3>What is a Mapping?</h3>
        <hr>
        <p>
          A Mapping represents one unit of a Plan.  Think of it as a single action that has InputConditions that need to be
          satisfied for it to start and then once it is started, OutputChanges can occur.  The OuputChanges can occur anytime during
          Mapping and there are currently five ways to control the timing of an OutputChange: On Start, Repeating, Behavior Invoked,
          On AnimationEvent, or On Finish.
          <br><br>
          A Mapping is a C# class that has a parent and children, so it is a Node in the Plan Tree.  If the parent is null
          it means the Mapping is a Root Mapping and will have at least one OutputChange that reduces the Plan's DriveType.
          If the Mapping has no children then the Mapping is a leaf in the Plan Tree.  If all of the leaves in a Plan Tree have
          all of their InputConditions satisified then the Agent can perform this Plan.  TAI considers the Plan to be "Complete".
          <br><br>
          Also if the Mapping's MappingType has at least one ICT that requires an Entity Target then the Mapping will have an
          Entity target.  An Entity
          target is passed to the BehaviorType, the code that actually runs the Mapping, so it can perform logic related to the
          target.  The Entity target is also passed to the OutputChanges that are set to TargetType of "ToTargetEntity".
        </p>
        <h3>How is a Mapping Created?</h3>
        <hr>
        <p>
          Mappings are usually created by the PlannerType when generating Plan Trees but special GoTo Mappings can also be generated
          while a Plan is being run by an Agent.  These are generated if the Mapping has an Entity Target and needs to get within
          interaction distance of the Entity Target.  By generating this GoTo Mappings only when running a Plan the overall
          number of Mappings in generated Plans is greatly reduced.  The GoToActionType is set on the MappingType and determines
          what BehaviorType should be used.
        </p>
        <h3>MappingType</h3>
        <hr>
        <p>
          A MappingType defines the configuration and logic of a Mapping.  A MappingType inherits from ScriptableObject and can
          be created similar to other ScriptableObjects by right clicking and following the menu.  MappingTypes can also be
          created in bulk by using <a class="text-link" href="doc-genericmappingtype.html">GenericMappingTypes</a>.
          MappingTypes contain the following fields:
          <ul>
            <li><b>InputConditions</b>: What needs to be true for an agent to perform this MappingType?</li>
            <li><b>OutputChanges</b>: What changes will occur at the start, during, and at the end of this MappingType?</li>
            <li><b>ActionType</b>: Acts as a grouping of MappingTypes and also specifies the BehaviorType that will occur.</li>
            <li><b>TargetFactors</b>: Utility AI style selectors for picking an Entity Target.</li>
            <li><b>AttributeFactors</b>: Utility AI style selectors for choosing attributes values to send to the BehaviorType.</li>
            <li><b>ActionSkills</b>: Modifiers to the MappingType due to the Agent's Action Skill Level.</li>
          </ul>
          For a how to on creating a MappingType see: 
          <a class="text-link" href="doc-how-to-create-mappingtype.html">How to Create a Mapping Type</a>.
        </p>
        <h3>InputConditions</h3>
        <hr>
        <p>
          A MappingType can have zero to many InputConditions (ICs).  Each IC represents one check to see if the Agent
          can perform this MappingType.  If all checks pass then the Mapping will be marked as "Completed".  If the 
          Agent is using the GOAPPlannerType or any PlannerType that can generate planning trees and an IC fails, the planner
          will try to find a MappingType with an OutputChange that "fixes" the InputCondition.  If it finds a fix, a
          new child Mapping will created.  For more information on how GOAPPlannerType generates Plan Trees see 
          <a class="text-link" href="doc-GOAP.html">GOAP Info</a>.
          <br><br>
          The two main fields on an IC is its type, InputConditionType (ICT), and what type of object,
          InputOutputType (IOT), it is checking.  The final fields on an IC define the values the ICT needs to do the check.
          The required values along with the specific IOT type are dependent on the ICT, so the ICT contains an
          EditorHelp class that will dynamically change the shown inspector fields to only show fields the ICT
          needs along with descriptions and tooltips.  It will also make the IOT field more specific.  For example if
          the ICT is for an AgentType, the editor will only allow you to select gentType ScriptableObject assets.
          <br><br>
          For a how to on creating an InputConditionType see: 
          <a class="text-link" href="doc-how-to-create-ict.html">How to Create an InputConditionType</a>.
        </p>
        <h3>OutputChanges</h3>
        <hr>
        <p>
          A MappingType can have zero to many OutputChanges (OCs).  An OC's Target Type can be for the Agent (ToSelf) or
          for the Target (ToEntityTarget).  An OC also has five Timing options: On Start, Repeating, Behavior Invoked,
          On AnimationEvent, or On Finish.  Behavior Invoked relies on the BehaviorType to specifically call an OutputChange
          check.  AnimationEvent relies on Unity's 
          <a class="text-link" target="_blank" href="https://docs.unity3d.com/Manual/script-AnimationWindowEvent.html">
            AnimationEvent
          </a>
          feature.  The AnimationEvent's Function name should be exactly "AnimationOutputChange".
          <br><br>
          An OC is similar to IC in that it's two main fields are a type, OutputChangeType (OCT), and an Object,
          InputOutputType (IOT).  Similar to an ICT, an OCT has an EditorHelp class in order to make the OC inspector
          dynamic based on the OCT.
          <br><br>
          An OC can contain OutputConditions if the OC needs to depend on an Entity existing or not existing or if
          the changes should randomly not occur.
          <br><br>
          <i>Key fields of an OC</i>
        </p>
        <h3>TargetFactors</h3>
        <hr>
        <p>
          If a MappingType has at least one ICT that requires an Entity Target, the Mapping will need to select an Entity Target
          that passes ALL of the EntityType ICs.  The logic for this is specified in the PlannerType.
          
          <i>(Should this logic be in plannerType?)</i>

          If there are multiple Entities found that pass all of the EntityType ICs, TargetFactors (TFs) come into play.  They
          provide a Utility AI like mechanism for choosing the best Entity.
          <br><br>
          A Mapping can have zero to many TFs.  If there are multiple TargetFactors you can supply a weight for each TargetFactor.
          The weights will be normalized.  For example if you have two TargetFactors, one with a weight of 0.5 and one with a weight
          of 1.0, the first one will count for 0.5/1.5 = 1/3 and the second one for 1.0/1.5 = 2/3.
          <br><br>
          The TargetFactor abstract class inherits from ScriptableObject.  All TargetFactors then inherit from TargetFactor.
          There is only one method that needs to be implemented, Evaluate.  Evaluate must return a value between 0-1 or -1.
          -1 is a special value denoting a veto.  If any TF returns -1, that Entity will be removed from consideration.
          <br><br>
          <i>Research exactly how TFs currently work.</i>
        </p>
        <h3>Selectors</h3>
        <hr>
        <p>
          Selectors are required to select the desired values for the BehaviorType for the corresponding
          AttributeType.  A Selector has three ways to choose the AttributeType value.
        </p>
        <ul>
          <li><b>Current</b>: Use the value which is set for the Agent's Attrbute when this MappingType runs.</li>
          <li><b>Fixed</b>: Specify the exact value to use everytime this MappingType is run.</li>
          <li><b>AttributeFactors</b>: Dynamically select the value using the specified AttributeFactors.</li>
        </ul>
        <p>
          The required AttributeValueSelectors will be shown automatically after the ActionType and GoToActionType are
          selected.  This is because the MappingType custom inspector pulls the required AttributeType info from the
          BehaviorType EditorHelp classes.  (A BehaviorType is attached to an ActionType.)
        </p>
        <h3>AttributeFactors</h3>
        <hr>
        <p>
          AttributeFactors (AFs) are similar to TargetFactors but are used to dynamically select the value of an
          AttributeType for a BehaviorType.  They can be used to eaither select a float value within a range or
          make a choice out of a fixed number of choices.  An AF has one main method, Evaluate.  This returns a
          float between 0-1.  This represents the normalized choice of that particular AttributeFactor.  For example
          if the AttributeType is a MinMaxFloatAT with a range of 0-10 and the AF returns 0.6 it means the AF is
          voting for a float value of 6.  Instead if its for an EnumStringAT with 10 choices it would bin the 0-1 float
          values into the following 10 bins:
          <br><br>
          <b>[0,.1), [.1, .2), [.2, .3), [.3, .4), [.4, .5), [.5, .6), [.6, .7), [.7, .8), [.8, .9), [.9, 1]</b>
          <br><br>
          If the AF returned a value of .6 it would be voting for choice 7 since '(' means exclusive and '[' means
          inclusive.
          <br><br>
          Similar to TFs multiple AFs would be combined with a weighted average.  Also AFs can decide
          not to contribute by returning -1f or respond with a veto (veto is an out bool varible).  The veto means
          the value it returns is chosen.  This causes the order of the AFs to matter since the first veto will
          be selected and the other AFs will not be run.
        </p>
        <h3>ActionSkills</h3>
        <hr>
        <p>
          Modifiers to the MappingType due to the Agent's Action Skill Level.  The skill level represents how good
          an Agent is at a certain ActionType.  Everytime an Agent performs an ActionType it has a probability
          of increasing the ActionType level by a certain amount.  The ActionSkills will change certain ICs or OCs
          based on the Action Skill.  For example the skill at MeleeAttack ActionType could change the amount of
          damage done to the Agent that is the Entity Target.
          <br><br>
          <i>Detail exactly how this works.</i>
        </p>
      </div>
      <div class="col-md-3">

      </div>
    </div>

    </main>

    <script>
      $(document).ready(function() {
        $(window).resize(function() {
          resize();
        });
        function resize() {
          var myheight = $(window).outerHeight(true) - 0;
          $('.main').outerHeight(myheight);
        }
        resize();
      });
    </script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
  </body>
</html>